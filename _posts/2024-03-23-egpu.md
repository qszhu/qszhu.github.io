---
layout: post
title: è®ºè¿™å¹´å¤´å¤ç°æ·±åº¦å­¦ä¹ çš„æˆæœæœ‰å¤šéš¾ğŸ¶
date: 2024-03-23 10:00:00 +0800
tags: [deep_learning, bev, transformer, self_driving]
---

**TLDR**: ä¸æŠ˜è…¾å°±ä¸ä¼šæ­»ç³»åˆ—

## èƒŒæ™¯1

å¤§çº¦7,8å¹´å‰å›½å†…åˆšèƒ½ä¹°åˆ°ç‰¹æ–¯æ‹‰çš„æ—¶å€™, æˆ‘æ›¾å…³æ³¨äº†ä¸€æ®µæ—¶é—´è‡ªåŠ¨é©¾é©¶æŠ€æœ¯çš„è¿›å±•, å¸Œæœ›èƒ½åˆ¤æ–­è‡ªåŠ¨é©¾é©¶æŠ€æœ¯æ˜¯å¦å·²ç»è¶³å¤Ÿæˆç†Ÿäº†. æ¯•ç«Ÿç‰¹æ–¯æ‹‰çš„ä¸€å¤§å–ç‚¹å°±æ˜¯å·ç§°èƒ½è‡ªåŠ¨é©¾é©¶. è€Œä½œä¸ºä¸€ä¸ªç å†œ, æˆ‘æœ‰æ—¶è¿è‡ªå·±å†™çš„ä»£ç éƒ½ä¸ç›¸ä¿¡, åˆæ€ä¹ˆä¼šè½»æ˜“æŠŠæ€§å‘½æ‰˜ä»˜ç»™åˆ«äººå†™çš„ä»£ç å‘¢ğŸ¶.

å½“æ—¶åŸºäºæ·±åº¦å­¦ä¹ æ–¹æ³•æ­£æŒç»­åœ¨å„é¡¹ä»»åŠ¡ä¸­åˆ·æ¦œ, æ‰€ä»¥ä¼¼ä¹ä¸šç•Œå¯¹äºæœ€ç»ˆèƒ½å®ç°è‡ªåŠ¨é©¾é©¶çš„ç›®æ ‡æ™®éä¹è§‚. æˆ‘ä¸€å¼€å§‹å¯èƒ½ä¹ŸæŒºä¹è§‚, ç›´åˆ°åœ¨æœ‹å‹çš„è‡ªåŠ¨é©¾é©¶ä¸­çš„ç‰¹æ–¯æ‹‰ä¸Šå·®ç‚¹ç»å†äº†æ’è½¦.

ä¹‹åä¼¼ä¹æ¯å¹´éƒ½å¯ä»¥è¯»åˆ°å‡ ç¯‡è‡ªåŠ¨é©¾é©¶ä¸­çš„ç”µåŠ¨æ±½è½¦å‘ç”Ÿæ¶æ€§äº‹æ•…çš„æŠ¥é“. ä¸šç•Œå¥½åƒä¹Ÿæ¸æ¸å˜å¾—æ²¡é‚£ä¹ˆè‡ªä¿¡, è‡ªåŠ¨é©¾é©¶è½åœ°çš„ç›®æ ‡ä»L5, L4ä¸€è·¯é™åˆ°L2. æˆ‘ä¹Ÿå°±æ²¡å†ç»§ç»­å…³æ³¨äº†. è€Œå½“å»å¹´çˆ†å‡ºç‰¹æ–¯æ‹‰å½“å¹´çš„è‡ªåŠ¨é©¾é©¶å®£ä¼ è§†é¢‘é€ å‡[1]çš„æ—¶å€™, æˆ‘å¥½åƒä¹Ÿæ²¡è§‰å¾—ç‰¹åˆ«æ„å¤–.

## èƒŒæ™¯2

æœ€è¿‘è€ƒè™‘ç»™å®¶é‡Œè´­ç½®æ–°è½¦, æ°é€¢å›½å†…æ–°èƒ½æºæ±½è½¦å‘å±•è¿…çŒ›, å°±å»è¯•é©¾äº†ä¸€äº›å›½äº§æ–°èƒ½æºå“ç‰Œ. å…¶ä¸­ææ°ª007[2]çš„AR-HUDç»™æˆ‘ç•™ä¸‹äº†æ·±åˆ»å°è±¡. å…¶ä»¥HUDçš„å½¢å¼æ˜¾ç¤ºäº†åœ¨è½¦èº«å››å‘¨è¯†åˆ«åˆ°çš„è½¦è¾†å’Œè¡Œäººç­‰, ä¸ç”¨åƒå…¶ä»–å“ç‰Œé‚£æ ·ä½å¤´å»çœ‹ä»ªè¡¨ç›˜æˆ–ä¸­æ§. è¿™æ ·å°±ç®—è¯†åˆ«åˆ°çš„ç»“æœä¸ç”¨äºè‡ªåŠ¨é©¾é©¶, ç”¨æ¥ç»™é©¾é©¶å‘˜è¡¥ç›²ä¹Ÿæ˜¯æå¥½çš„. è€Œä¸”åœ¨æ²¡æœ‰æ¿€å…‰é›·è¾¾çš„è½¦å‹ä¸Šä¹Ÿæœ‰å®è£…, è¯´æ˜æ˜¯ç§çº¯è§†è§‰æ–¹æ¡ˆ. è¿™åˆè®©æˆ‘æ¥äº†å…´è¶£, å†æ¬¡å…³æ³¨èµ·è‡ªåŠ¨é©¾é©¶æŠ€æœ¯(å°¤å…¶æ˜¯æ„ŸçŸ¥æ–¹é¢)çš„è¿›å±•.

åˆæ­¥è°ƒç ”çš„ç»“æœ, è¿‘å‡ å¹´ä¸€ç§åä¸ºTransformerçš„æ¶æ„åœ¨æ·±åº¦å­¦ä¹ é¢†åŸŸå¤§æ€å››æ–¹. åœ¨è‡ªåŠ¨é©¾é©¶é¢†åŸŸåˆ™ç›´æ¥å¯¼è‡´äº†åº•å±‚æ„ŸçŸ¥æ¡†æ¶çš„æ´—ç‰Œ. æœ€æ–°çš„è¶‹åŠ¿åˆ™æ˜¯åœ¨BEV(Bird's-Eye-View)è¡¨å¾ä¸­åšæ„ŸçŸ¥. æ‰¾åˆ°äº†ä¸€ç¯‡æ®è¯´æ˜¯æ•ˆæœæœ€å¥½çš„å¼€æºæ–¹æ¡ˆBEVFormer[3]. äºæ˜¯æˆ‘å°±å†³å®šå¤ç°ä¸€ä¸‹, ä¸æƒ³å´æ˜¯ä¸€ç³»åˆ—æŠ˜è…¾çš„å¼€å§‹.

## ç¡¬ä»¶æ–¹æ¡ˆ

ç¬¬ä¸€æ­¥å®‰è£…[4]çš„æ—¶å€™å°±å¡ä½äº†. BEVFormerä¾èµ–äº†OpenMMLab[5]çš„mmcvå’Œmmdet3dç­‰, éœ€è¦ä¾èµ–CUDA. è™½ç„¶ä¹‹å‰å…³æ³¨æ·±åº¦å­¦ä¹ å’Œè‡ªåŠ¨é©¾é©¶çš„æ—¶å€™åœ¨å®¶é‡Œè£…è¿‡ä¸€å°GeForce 1080çš„PC, ä½†åœ¨ç»“å©šä»¥åå°±ç»™è€å©†ç”¨äº†. æˆ‘è‡ªå·±åˆ™æ˜¯ä¸€ç›´åœ¨ç”¨Mac, å†ä¹Ÿæ²¡ç”¨è¿‡PC. è¿™å¹´å¤´è€é»„çš„RTX 40ç³»æ˜¾å¡é‚£ä¹ˆè´µ, é‡æ–°è£…ä¸€å°PCä¼¼ä¹è¦èŠ±æ¯”å½“å¹´æ›´å¤šçš„é’±. æ€æ¥æƒ³å», ç›®å‰æˆ‘æ‰‹å¤´æ€§èƒ½æœ€å¥½çš„PCä¼¼ä¹æ˜¯--[Steam Deck](/2023/12/03/steamdeck.html)?

è¦ç»™Steam Deckè¿™æ ·çš„â€œPCâ€è£…ä¸Šæ˜¾å¡, æ˜¾ç„¶æ— æ³•å†…ç½®è€Œåªèƒ½å¤–æ¥[6]. ç„¶è€Œå¤–æ¥ä¹Ÿæœ‰é—®é¢˜. é€šå¸¸å¤–æ¥æ˜¾å¡éƒ½éœ€è¦åˆ©ç”¨USB4[7]æˆ–æ˜¯é›·é›³[8]è¿™æ ·çš„é«˜é€Ÿçº¿ç¼†, è¿™æ ·æ‰èƒ½åŒ¹é…ä¸ŠPCIe 4.0[9]çš„ä¼ è¾“é€Ÿç‡. è€ŒSteam Deck[10]çš„Type-Cåªæœ‰USB 3.2[11], å¹¶ä¸”å¸‚é¢ä¸Šä¼¼ä¹ä¹Ÿæ²¡æœ‰USB3çš„å¤–æ¥æ˜¾å¡æ–¹æ¡ˆ. éš¾é“å°±æ²¡æœ‰åŠæ³•äº†å—?

è®°å¾—å½“å¹´è¿˜ç»™å…¬å¸ç»„è¿‡ä¸€å°å¤šå¡çš„å·¥ä½œç«™, ä½†å› ä¸ºä¸»æ¿å¤§å°å’Œæ˜¾å¡åšåº¦çš„å…³ç³», å¯¼è‡´æ˜¾å¡æŒ¨å¾—å¾ˆè¿‘æ— æ³•æœ‰æ•ˆæ•£çƒ­:

![gpus](/assets/images/2024-03-23/gpus.JPG)

è€Œä¸”å½“å¹´ä¼¼ä¹è¿˜æ²¡æœ‰æ”¹é€ æ˜¾å¡é£é“çš„å»‰ä»·æ–¹æ¡ˆ, æ‰€ä»¥æœ€ç»ˆé‡‡ç”¨äº†å»¶é•¿PCIeæ¥å£çš„æ–¹å¼ç©ºå¼€æ˜¾å¡ä¹‹é—´çš„è·ç¦»:

![external](/assets/images/2024-03-23/external.JPG)

å…¶å®è¿™å·²ç»å¯ä»¥è§†ä¸ºä¸€ç§â€œå¤–æ¥â€æ˜¾å¡çš„æ–¹æ¡ˆäº†. ä½†Steam Deckä¸Šå¹¶æ²¡æœ‰PCIeæ¥å£, å´å­˜åœ¨ä¸€ç§æ›²çº¿æ•‘å›½çš„æ–¹å¼, é‚£å°±æ˜¯ç”¨æ¥æ’SSDçš„M.2[12]. ä¸è¿‡è™½ç„¶M.2å·ç§°å¯ä»¥æ”¯æŒåˆ°PCIe 4.0 x4, å…·ä½“æ”¯æŒåˆ°ä»€ä¹ˆç¨‹åº¦è¿˜æ˜¯è¦çœ‹åˆ¶é€ å•†çš„å¿ƒæƒ…. ä½†è‡³å°‘ä»æ¥å£ä¸Šçœ‹, è¿™æ¡é“¾è·¯èƒ½è·‘é€š. å¹¶ä¸”å¸‚é¢ä¸Šå·²ç»æœ‰æˆç†Ÿçš„M.2è½¬OCuLink[13]çš„eGPUæ–¹æ¡ˆ.

![eGPU](/assets/images/2024-03-23/egpu.JPG)

é¡ºå¸¦ä¸€æ, æ—©äº›å¹´IntelèŠ¯ç‰‡çš„Macæ›¾ç»ä¹Ÿå¯ä»¥å¤–æ¥æ˜¾å¡[14]. ä½†è¿‘å¹´æ¥Macéƒ½ç”¨ä¸Šäº†è‡ªå®¶çš„MèŠ¯ç‰‡, è€Œä¸”è€é»„å®¶çš„æ˜¾å¡é©±åŠ¨åœ¨Macæ—©å°±æ–­æ›´äº†å¤šå¹´, æ‰€ä»¥ç”¨Macå¤–æ¥æ˜¾å¡å¦‚ä»Šå¹¶ä¸èƒ½æˆä¸ºä¸€ä¸ªé€‰é¡¹.

## ç¡¬ä»¶å‡†å¤‡

ç»™Steam Deckæ¢ä¸ŠM.2è½¬æ¥å£æ²¡ä»€ä¹ˆé—®é¢˜, åªè¦æ˜¯ç»™Steam Deckå‡çº§è¿‡å†…ç½®SSDçš„éƒ½å¯ä»¥ç†Ÿé—¨ç†Ÿè·¯:

![sd](/assets/images/2024-03-23/sd.JPG)

ä½†å› ä¸ºå¸ä¸‹äº†SSD, æ‰€ä»¥Steam Deckå°±æ²¡æœ‰äº†å†…éƒ¨å­˜å‚¨å™¨, éœ€è¦ä»å¤–éƒ¨å­˜å‚¨å™¨ä¸Šå¯åŠ¨. æœ€ç®€å•çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªWindows To Goçš„å¯åŠ¨Uç›˜[15]. æ’ä¸Šå¤–æ¥æ˜¾å¡å’Œå¯åŠ¨ç›˜, Steam Deckå¯åŠ¨!

![boot](/assets/images/2024-03-23/boot.JPG)

ç„¶åå°±å¡ä½ä¸åŠ¨äº†!

æ¢äº†Ubuntuçš„å¯åŠ¨ç›˜åˆ™æ˜¯åœ¨GRUBèœå•ç›´æ¥é»‘å±. æ²¹ç®¡ä¸Šèƒ½æ‰¾åˆ°ä¸€äº›åšç›¸åŒå°è¯•çš„äººé‡åˆ°åŒæ ·çš„é—®é¢˜[16], è€Œæœ€ç»ˆæˆåŠŸçš„æ–¹æ¡ˆéƒ½æ˜¯æ¢äº†AMDçš„æ˜¾å¡ğŸ¶. ç”±äºç¼ºä¹è°ƒè¯•Steam Deckçš„æ‰‹æ®µ, è¿™ä¸ªæ–¹æ¡ˆé™·å…¥äº†åƒµå±€.

## ç¡¬ä»¶æ–¹æ¡ˆ2

å·¦æ€å³æƒ³ä¹‹åæƒ³èµ·è¿˜æœ‰ä¸€å°å¤šå¹´å‰æ·˜æ±°ä¸‹æ¥æ­£åœ¨ç§¯ç°çš„è¿·ä½ PC: Dell OptiPlex 3070. æ„Ÿå—ä¸€ä¸‹é…ç½®:

* Intel Pentium G5420T (åŒæ ¸å››çº¿ç¨‹)
* 2 x 4 GB DDR4 (ä¹‹åå‡çº§è¿‡å†…å­˜)
* M.2 (æœ€é«˜æ”¯æŒ1T SSD)

å› ä¸ºæ˜¯è¿·ä½ PC, ä¸ºäº†èŠ‚çº¦å†…éƒ¨ç©ºé—´, ç¡¬ç›˜æ¶æ˜¯ç›–åœ¨M.2æ¥å£ä¸Šçš„. è€Œæ¢ä¸Šè½¬æ¥å£æ’ä¸Šæ˜¾å¡ä¹‹å, ç¡¬ç›˜æ¶å°±æ”¾ä¸ä¸‹äº†. å¥½åœ¨ä¸Šé¢å·²ç»å‡†å¤‡äº†å¯åŠ¨ç›˜, æ‰€ä»¥ä¹Ÿæ²¡é—®é¢˜. æ’ä¸Šå¯åŠ¨ç›˜å¯åŠ¨!

![optiplex](/assets/images/2024-03-23/optiplex.jpg)

ç„¶åå°±æˆåŠŸäº†! Windowså¯åŠ¨åç”šè‡³è¿˜è‡ªåŠ¨è£…å¥½äº†æœ€æ–°çš„NVæ˜¾å¡é©±åŠ¨.

![gpuz](/assets/images/2024-03-23/gpuz.JPG)

ä¸è¿‡æ¥å£é€Ÿåº¦å°±åªæœ‰PCIe 2.0 x4, åªèƒ½è¯´èŠèƒœäºæ— å§.

## è½¯ä»¶å¼€å‘ç¯å¢ƒ

å½“å¹´æè¿‡æ·±åº¦å­¦ä¹ çš„äººå¤§å¤šéƒ½è¢«Linuxä¸‹çš„NVé©±åŠ¨çš„å®‰è£…æŠ˜ç£¨è¿‡. å¦‚ä»ŠWindowsä¸‹æœ‰WSL, è¿˜éœ€è¦æŠ˜è…¾å—? è¯•ä¸‹æ¥æœ€åˆçš„ä½“éªŒç®€ç›´å¯ä»¥ç”¨ä¸æ»‘æ¥å½¢å®¹. ç”±äºWindowså·²ç»è‡ªåŠ¨è£…å¥½äº†NVé©±åŠ¨, åªè¦å†è£…ä¸ªWSL, ä¸‹è½½ä¸ªè™šæ‹Ÿæœº, è™šæ‹Ÿæœºæ‰“å¼€å°±èƒ½ç›´æ¥çœ‹åˆ°æ˜¾å¡:

![nvidia-smi](/assets/images/2024-03-23/nvidia-smi.JPG)

è¿˜æœ‰æ›´å¥½çš„. å®‰è£…äº†VS Codeä¹‹å, å…¶ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°WSLå¹¶å®‰è£…ç›¸å…³æ’ä»¶. ä¹‹ååªè¦åœ¨WSLè™šæ‹Ÿæœºä¸­çš„ä»»ä½•ç›®å½•é‡Œè¾“å…¥`code .`, å°±èƒ½æ‰“å¼€ä¸»æœºä¸­çš„VS Code, å¹¶èƒ½åœ¨VS Codeä¸­ç›´æ¥ç¼–è¾‘å’Œè¿è¡Œè™šæ‹Ÿæœºä¸­çš„æ–‡ä»¶!

ä½ å¤§çˆ·å¾®è½¯è¿˜æ˜¯ä½ å¤§çˆ·å‘€!

## ç»§ç»­å®‰è£…

å›åˆ°BEVFormerçš„å®‰è£…æ­¥éª¤[4]. å¯ä»¥çœ‹åˆ°ä½œè€…å·²ç»å°½å¯èƒ½é™åˆ¶äº†å¤ç°æ‰€ä¾èµ–çš„è½¯ä»¶ç‰ˆæœ¬, ä»Pythonåˆ°PyTorchåˆ°CUDA, ä¸ä¸€è€Œè¶³. ä½†åœ¨ä»æºç å®‰è£…mmdet3dæ—¶è¿˜æ˜¯é‡åˆ°äº†ä¾èµ–ç‰ˆæœ¬å†²çªçš„æƒ…å†µ. ç”±äºæ²¡æœ‰ä½¿ç”¨æŸç§èƒ½é”å®šä¾èµ–ç‰ˆæœ¬çš„æœºåˆ¶, å¯¼è‡´å®‰è£…æ—¶æ‹‰å–äº†æŸäº›ä¾èµ–çš„æœ€æ–°ç‰ˆæœ¬, ä¸ä½œè€…å¸Œæœ›å›ºå®šä¸‹æ¥çš„æ—§ç‰ˆæœ¬è½¯ä»¶äº§ç”Ÿäº†å†²çª. è€Œä¼—æ‰€å‘¨çŸ¥`pip`æ²¡æœ‰èƒ½è‡ªåŠ¨è§£å†³ä¾èµ–å†²çªçš„èƒ½åŠ›, åªèƒ½é æ‰‹å·¥ä¸€ä¸ªä¸ªå®‰è£…å†²çªä¾èµ–çš„æ—§ç‰ˆæœ¬æ¥è§£å†³. å¥½åœ¨å†²çªä¹Ÿä¸å¤š, ä¸»è¦æ˜¯`numpy`, `sklearn`è¿™äº›å¸¸è§ä¸”æ›´æ–°æ¯”è¾ƒå‹¤å¿«çš„åŒ…, å¤šå°è¯•å®‰è£…å‡ ä¸ªä¸åŒçš„æ—§ç‰ˆæœ¬å°±å¯ä»¥äº†.

ä¸‹é¢ç»§ç»­å®‰è£…detectron2çš„æ—¶å€™ä¹Ÿæœ‰ä¸Šè¿°åŒæ ·çš„é—®é¢˜. è€Œä¸”åˆå‡ºç°äº†ä¸€ä¸ªæ–°é—®é¢˜, è¯´æ˜¯æ²¡æœ‰`nvcc`. æ‰€ä»¥Windowsè‡ªåŠ¨å®‰è£…çš„NVé©±åŠ¨å¹¶ä¸åŒ…å«CUDA Toolkit[17], ä»æ—§éœ€è¦æ‰‹åŠ¨å®‰è£…. å¹¶ä¸”éœ€è¦ä¸ä¹‹å‰å®‰è£…çš„è½¯ä»¶ä¾èµ–çš„CUDAç‰ˆæœ¬ä¸€è‡´. è¿™é‡Œéœ€è¦çš„æ˜¯CUDA 11.1. é¡ºä¾¿åæ§½ä¸‹NVå®˜ç½‘ä¸Šæ—§ç‰ˆæœ¬çš„CUDAé“¾æ¥ä¸å¤§å¥½æ‰¾, è¿˜ä¸å¦‚ä»æœç´¢å¼•æ“ç›´æ¥è¿›å…¥.

è‡³æ­¤è½¯ä»¶ä¾èµ–åº”è¯¥éƒ½å·²ç»å®‰è£…å¥½äº†. ä¸‹ä¸€æ­¥è¦å‡†å¤‡æ•°æ®.

## æ•°æ®å‡†å¤‡

æ ¹æ®è¯´æ˜[18], éœ€è¦ä¸‹è½½nuScenes[19]çš„å®Œæ•´æ•°æ®. ä¸çœ‹ä¸çŸ¥é“, ä¸€çœ‹å“ä¸€è·³. éœ€è¦ä»AWSä¸Šæ‹‰ä¸‹æ¥çš„å‹ç¼©åŒ…æ€»å…±çº¦æœ‰300G. å¦‚æœä¼°è®¡è§£å‹åæœ‰500Gçš„è¯, å°±éœ€è¦å°†è¿‘1Tçš„å‰©ä½™ç©ºé—´æ‰èƒ½æ”¾å¾—ä¸‹. ä¸å¾—å·²åªèƒ½å†å¤–æ¥ä¸€ä¸ªç§»åŠ¨ç¡¬ç›˜.

æ›´æ²¡æƒ³åˆ°çš„æ˜¯, ä¸‹è½½å·²ç»å¾ˆæ…¢äº†, è§£å‹è¿˜è¦æ›´æ…¢. è§£å‹å‡ ç™¾Gçš„æ•°æ®, å†™å…¥ç¡¬ç›˜çš„é€Ÿåº¦åˆ°åé¢å°±åªæœ‰å‡ ç™¾K/s. åœ¨Windows/WSL/Macä¸­è§£å‹éƒ½ä¸€æ ·; å¤–æ¥ç§»åŠ¨ç¡¬ç›˜æˆ–æ˜¯SSDä¹ŸåŒºåˆ«ä¸å¤§. è€Œå¦‚æœç›´æ¥å¤åˆ¶å‹ç¼©åŒ…çš„è¯é€Ÿåº¦å¯ä»¥æœ‰ä¸Šç™¾M/s. è§‚å¯Ÿä¸‹æ¥å‘ç°å†™å…¥é€Ÿåº¦æ…¢çš„æ—¶å€™æ­£åœ¨è§£å‹å¤§é‡çš„å°æ–‡ä»¶. é™¤äº†ç¡¬ä»¶çš„é™åˆ¶å¤–ä¹Ÿæœ‰å¯èƒ½æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„é”…, ä¸è¿‡æ—¶é—´æœ‰é™æ²¡æœ‰å°è¯•æ¯”è¾ƒä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿ. è¿™å¯å¦‚ä½•æ˜¯å¥½?

äºæ˜¯æƒ³åˆ°æ—¢ç„¶è§£å‹æ…¢, æœ‰æ²¡æœ‰å¯èƒ½ä¸è§£å‹ç›´æ¥ç”¨å‘¢. æ¯”å¦‚é€šè¿‡FUSE[20]ç›´æ¥æŠŠå‹ç¼©åŒ…å½“æˆæ–‡ä»¶ç³»ç»ŸæŒ‚è½½. æœäº†ä¸€ä¸‹è¿˜çœŸçš„æ‰¾åˆ°äº†ä¸ªå«`ratarmount`[21]çš„å·¥å…·, å…¶ä½¿ç”¨åœºæ™¯é‡Œå°±æœ‰ç›´æ¥æŒ‚è½½ImageNetå‹ç¼©åŒ…çš„ä¾‹å­.

## æ•°æ®æŒ‚è½½

äºæ˜¯å°±å°è¯•ç”¨`ratarmount`å»æŒ‚è½½å‹ç¼©åŒ…, å¯ä»¥çœ‹åˆ°å…¶ä¼šä¸ºå‹ç¼©åŒ…åˆ›å»ºç´¢å¼•, ç”¨æ¥åœ¨éœ€è¦æ—¶å¿«é€Ÿå®šä½åŒ…å†…æ–‡ä»¶çš„ä½ç½®. ä¸è¿‡è·‘åˆ°ä¸€åŠå°±è¢«`Killed`äº†. è¿™ä¸ªæˆ‘ç†Ÿ, OOMäº†å‘—. å°±å‡†å¤‡æŠŠç³»ç»Ÿè™šæ‹Ÿå†…å­˜è°ƒå¤§ç‚¹è¯•è¯•. ç„¶åç ”ç©¶äº†åŠå¤©Windowsçš„è™šæ‹Ÿå†…å­˜åœ¨å“ªé‡Œè®¾ç½®, ç»è¿‡ä¸€è¿ä¸²çš„ç‚¹å‡»å’Œè®¾ç½®ä»¥åŠé‡å¯...è¿˜æ˜¯è¢«`Killed`.

è¿™æ—¶æ‰ååº”è¿‡æ¥è¯¥è°ƒçš„åº”è¯¥æ˜¯WSLè™šæ‹Ÿæœºä¸­çš„å†…å­˜[22], å±…ç„¶æ˜¯éœ€è¦åœ¨ç”¨æˆ·ç›®å½•åˆ›å»ºä¸€ä¸ª`.wslconfig`æ–‡ä»¶è¿›è¡Œé…ç½®. åˆ†é…å¥½è¶³å¤Ÿçš„å†…å­˜ä¹‹åæ•°æ®æŒ‚è½½å°±æˆåŠŸäº†.

## æ•°æ®åˆ›å»º

æ ¹æ®è¯´æ˜[18], æ¥ä¸‹æ¥éœ€è¦è·‘ä¸€ä¸ªè„šæœ¬æ¥åˆ›å»ºä¸€äº›pickleæ–‡ä»¶. ä¸è¿‡ä¸€è·‘å°±å‡ºé”™, è¯´æ˜¯`ImportError`. çœ‹äº†ä¸‹é™¤äº†`tools/data_converter/indoor_converter.py`ä¹‹å¤–, è¿™ä¸ªç›®å½•ä¸­çš„å…¶ä»–æ–‡ä»¶ç”¨çš„éƒ½æ˜¯ç›¸å¯¹import. æ‰€ä»¥è¦ä¹ˆä¿®æ”¹`PYTHONPATH`è¦ä¹ˆæŠŠè¿™ä¸ªæ–‡ä»¶çš„importä¹Ÿæ”¹æˆç›¸å¯¹çš„.

æ­¤å¤–, ä½œè€…é»˜è®¤æŠŠç”Ÿæˆçš„pickleæ–‡ä»¶å†™åˆ°åŸå§‹çš„æ•°æ®ç›®å½•é‡Œ. ä½†æˆ‘åœ¨æŒ‚è½½å‹ç¼©åŒ…æ—¶åˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯åªè¯»çš„, å†™å…¥æ•°æ®å°±ä¼šå¤±è´¥. å¥½åœ¨è¿™ä¸ªåˆ›å»ºæ•°æ®çš„è„šæœ¬å¯ä»¥æŒ‡å®šè¾“å‡ºç›®å½•, æˆ‘å°±æŒ‡å®šäº†æœ¬åœ°çš„å¦ä¸€ä¸ªç›®å½•, å®Œæˆäº†æ•°æ®çš„åˆ›å»º.

## æµ‹è¯•

ä¸‹è½½äº†ä¸€ä¸ªtiny[23]æ¨¡å‹çš„æƒé‡æ¥æµ‹è¯•[24]. ä½œè€…é»˜è®¤ç”¨8ä¸ªGPU, ç„¶è€Œæˆ‘æŠŠå‚æ•°æ”¹æˆ1ä»¥åè·‘èµ·æ¥å´æ˜¯é—®é¢˜ä¸€ä¸ªæ¥ä¸€ä¸ª.

é¦–å…ˆæ˜¯æŠ¥é”™:

```bash
RuntimeError: NCCL error in: ../torch/lib/c10d/ProcessGroupNCCL.cpp: 911,
unhandled system error
```

è¿˜çœŸæ˜¯éå¸¸æœ‰ç”¨çš„ä¿¡æ¯ğŸ¶. NCCLæ˜¯å¤šå¡è®­ç»ƒæ—¶ç”¨åˆ°çš„åº“[25], æ‰€ä»¥å°±ç®—æˆ‘åœ¨å‚æ•°é‡ŒæŒ‡å®šäº†åªç”¨1ä¸ªGPU, è„šæœ¬é‡Œæœ€ç»ˆè¿˜æ˜¯ç”¨åˆ°äº†NCCL? æ­¤æ—¶éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡`NCCL_DEBUG`[26], è°ƒæˆ`WARN`æˆ–`INFO`çœ‹ä¸‹æ›´è¯¦ç»†çš„ä¿¡æ¯:

```bash
NCCL WARN Could not find real path of /sys/class/pci_bus/...
```

è¿™å°±å¾ˆæœ‰æ„æ€äº†, NCCLè¯´æ‰¾ä¸åˆ°æ˜¾å¡? æœäº†ä¸€ä¸‹è¿˜çœŸæ˜¯, æ—§ç‰ˆæœ¬çš„NCCLåœ¨WSLä¸­ä¸æ”¯æŒå¤šGPU[27]. ç”±äºä½œè€…é™åˆ¶äº†PyTorchçš„ç‰ˆæœ¬, ä¹Ÿå°±é™åˆ¶äº†NCCLçš„ç‰ˆæœ¬. è¦å•ç‹¬å‡çº§NCCLç‰ˆæœ¬çš„è¯è¿˜è¦é‡æ–°ç¼–è¯‘PyTorch. å…ˆæƒ³æƒ³åˆ«çš„åŠæ³•å§.

çœ‹äº†ä¸‹`tools/test.py`ä¸­æœ‰è¿™æ ·çš„ä»£ç [28]:

```python
if args.launcher == 'none':
  distributed = False
else:
  distributed = True
```

æ‰€ä»¥åªè¦å»æ‰`launcher`å‚æ•°å°±å¥½äº†å˜›? æ‰æ€ª. è·‘åˆ°ä¸‹é¢åˆæŠ¥é”™äº†[29]:

```python
if not distributed:
  assert False
```

è¿™å¾—æ˜¯æœ‰å¤šä¸å¾…è§å•å¡ç”¨æˆ·å•Š. è¿™ä¸‹æ”¹å®Œä»¥åæ€»èƒ½è·‘äº†å§? æ‹¿è¡£æœ, ç›´æ¥Core Dump:

```
Illegal instruction
```

ä»€ä¹ˆéƒ½ä¸è¯´äº†, é¼“æŒå§ğŸ‘.

é¼“å®ŒæŒç¥­å‡º`gdb`, åœ¨æ–­ç‚¹å¤„åæ±‡ç¼–, çœ‹åˆ°äº†è¿™æ ·çš„ç”»é¢:

![gdb](/assets/images/2024-03-23/gdb.JPG)

ç®­å¤´æ‰€æŒ‡å¤„çš„`vxorpd`æ˜¯ä¸€æ¡AVXæŒ‡ä»¤[30]. æ‰€ä»¥é—®é¢˜å°±åœ¨äºè¿™å°OptiPlex 3070çš„Pentium G5420Tåªæ”¯æŒSSE, ä¸æ”¯æŒAVXæŒ‡ä»¤[31].

æ­¤å¤–è™½ç„¶æ–­ç‚¹æ‰€å¤„çš„æ–‡ä»¶æ˜¯`libtorch_cuda.so`, ä½†åœ¨PyTorchä»£ç åº“çš„å†å²ç‰ˆæœ¬å’Œæœ€æ–°ç‰ˆæœ¬ä¸­ä¼¼ä¹å¹¶æ²¡æœ‰æ‰€è°“çš„`cutlass_image_network`çš„ä»£ç . è€Œ`cutlass`[32]åˆ™æ˜¯NVçš„ä¸€ä¸ªåŸºäºCUDAçš„åŠ é€Ÿåº“. æ‰€ä»¥åœ¨ä¸æ”¯æŒçš„CPUä¸Šè°ƒç”¨ä¸å­˜åœ¨çš„æŒ‡ä»¤è¿™äº‹æ˜¯è°çš„é”…å‘¢? æ‡‚è¡Œçš„å¯ä»¥è¯´è¯´.

## æµ‹è¯•2

å¹¸å¥½è¿™å°OptiPlexé™¤äº†èµ›æ‰¬å’Œå¥”è…¾ä»¥å¤–, i3/i5/i7éƒ½å¯ä»¥æ’[33]. è¿™äº›éƒ½æ˜¯æ”¯æŒAVXæŒ‡ä»¤é›†çš„, å°±æ˜¯å¹´ä»£ä¹…è¿œåªèƒ½ä¹°åˆ°åå¼ºåŒ—çš„äºŒæ‰‹æ•£ç‰‡, ä»·æ ¼å€’æ˜¯ä¸è´µ. æ¢äº†CPUä»¥åå‰©ä¸‹çš„å°±éƒ½æ˜¯å°é—®é¢˜äº†.

è·‘åˆ°Evaluationçš„æ—¶å€™åˆæŠ¥é”™, è¯´æ‰¾ä¸åˆ°æ•°æ®é›†. çœ‹äº†ä¸‹ä»£ç [34], æ¨¡å‹çš„æ•°æ®ç›®å½•éƒ½è¢«å†™æ­»äº†, ä¼¼ä¹ä¹Ÿæ²¡æœ‰æä¾›è¦†ç›–çš„æ–¹æ³•. æŒ‰ç…§ä½œè€…æä¾›çš„è¯´æ˜é‡Œç»„ç»‡ç›®å½•ç»“æ„[18]çš„è¯å°±ä¸ä¼šæœ‰é—®é¢˜, ä½†å› ä¸ºæˆ‘åœ¨ä¸Šé¢åˆ›å»ºæ•°æ®æ—¶ä¸ºäº†å›é¿åªè¯»æ–‡ä»¶ç³»ç»Ÿçš„é—®é¢˜, ä½¿ç”¨äº†åˆ«çš„è·¯å¾„, åˆ°è¿™é‡Œå°±ä¸è¡Œäº†. è§£å†³çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•, æŠŠåˆ›å»ºå‡ºæ¥çš„æ•°æ®æ–‡ä»¶ä¹Ÿæ‰“ä¸ªåŒ…è·Ÿå…¶ä»–æ•°æ®åŒ…æŒ‚è½½åˆ°ä¸€èµ·å°±å¥½äº†.

è¿™æ ·ç»ˆäºè·‘å‡ºäº†ç»“æœ:

![eval](/assets/images/2024-03-23/eval.JPG)

å¯ä»¥çœ‹åˆ°`mAP: 0.2519`, `NDS: 0.3545`, ä¸ä½œè€…æŠ¥å‘Šçš„ç»“æœä¸€è‡´[23].

å¯è§†åŒ–ç»“æœ:

![bev](/assets/images/2024-03-23/bev.png)
![camera](/assets/images/2024-03-23/camera.png)

## å°ç»“

ç®€è¦æ€»ç»“ä¸‹è¿™æ¬¡é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•:

* éœ€è¦CUDAä½†æ²¡æœ‰PC --> Steam DeckåŠ eGPU
  * Steam Deckæ²¡æœ‰USB4 --> M.2è½¬æ¥OCuLink
  * å¸äº†SSDæ²¡æœ‰äº†ç³»ç»Ÿç›˜ --> å¤–æ¥Uç›˜å¯åŠ¨Windows To Go
* Steam Deckæ— æ³•å¯åŠ¨ --> æ¢Dell OptiPlex
* Pythonä¾èµ–å†²çª --> æ‰‹åŠ¨é™çº§æŸäº›ä¾èµ–åŒ…çš„ç‰ˆæœ¬
* ç¼ºå°‘`nvcc` --> å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„CUDA Toolkit
* æ•°æ®è§£å‹å¤ªæ…¢ --> ç”¨`ratarmount`ç›´æ¥æŒ‚è½½
  * æŒ‚è½½æ—¶å†…å­˜ä¸è¶³ --> è°ƒæ•´WSLè™šæ‹Ÿæœºä¸­çš„å†…å­˜å¤§å°
* åˆ›å»ºæ•°æ®è„šæœ¬é”™è¯¯ --> ä¿®æ­£import
  * åªè¯»æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿæ— æ³•å†™å…¥ --> æŒ‡å®šå¦å¤–çš„å†™å…¥è·¯å¾„
* æµ‹è¯•è„šæœ¬æŠ¥NCCLé”™è¯¯ --> ä¿®æ”¹è„šæœ¬åªä½¿ç”¨å•å¡
* æµ‹è¯•è„šæœ¬æŠ¥éæ³•æŒ‡ä»¤ --> æ¢CPU
* æ¨¡å‹çš„æ•°æ®ç›®å½•è¢«å†™æ­» --> æŠŠåˆ›å»ºå‡ºæ¥çš„æ•°æ®ä¹ŸæŒ‚è½½åˆ°åŸå§‹æ•°æ®çš„ç›®å½•ä¸­

ç”±æ­¤å¯è§è¿™å¹´å¤´å¤ç°åˆ«äººçš„æˆæœæœ‰å¤šéš¾ğŸ¶

å½“ç„¶ä¸Šè¿°å¤§éƒ¨åˆ†é—®é¢˜éƒ½æ˜¯æŠ˜è…¾å‡ºæ¥çš„. ç†æƒ³æƒ…å†µå°±æ˜¯æ‹¥æœ‰å’Œä½œè€…ä¸€æ ·çš„è½¯ç¡¬ä»¶ç¯å¢ƒ. åªè¦ä½œè€…æ³¨æ„ä¸‹é”æ­»ä¾èµ–çš„ç‰ˆæœ¬, å¹¶ä¸”ä»£ç é‡Œä¸è¦å†™æ­»å¤ªå¤šä¸œè¥¿å°±å¯ä»¥. ä½†å¤šå¡ç¯å¢ƒä¾æ—§æ˜¯è¶…å‡ºæ¶ˆè´¹çº§çš„èŒƒç•´çš„. è¦ä¸æ˜¯æˆ‘ç•™ç€è€é»„çš„æ˜¾å¡è¿˜æœ‰åˆ«çš„ç”¨é€”(æ‰ä¸æ˜¯ä¸ºäº†æ‰“æ¸¸æˆ!), æˆ‘ä¼šé€‰æ‹©äº‘ç«¯çš„ç¯å¢ƒ. å°±æ˜¯è¿™æ¬¡è¿™æ•°æ®é‡, ä½¿ç”¨äº‘ç›˜çš„å¼€é”€å¯èƒ½ä¹Ÿæ¯”è¾ƒå¤§.

æ­¤å¤–ä¹Ÿå¯ä»¥çœ‹åˆ°, ä¸Šè¿°è¿‡ç¨‹ä¹Ÿå°±æ˜¯ä¸€ä¸ªå‘ç°é—®é¢˜->ä½œå‡ºå†³ç­–->è§£å†³é—®é¢˜çš„è¿­ä»£è¿‡ç¨‹. æœ€è¿‘æœ‰ä¸ªå«`Devin`[35]çš„AIå°±å·ç§°èƒ½åƒäººç±»ä¸€æ ·å®Œæˆè¿™æ ·çš„å·¥ä½œ. è¦æ˜¯äº‘ç«¯çš„æ²™ç›’ç¯å¢ƒè¶³å¤Ÿå¼ºå¤§çš„è¯, å®ƒæ˜¯å¦èƒ½æŠŠäººç±»ä»é‡ç°åˆ«äººå·¥ä½œçš„ä»»åŠ¡ä¸­è§£æ”¾å‡ºæ¥å‘¢? æ„Ÿè§‰å¯ä»¥æœŸå¾…ä¸€ä¸‹.

è¿™æ¬¡è¿˜æœ‰å¦ä¸€ä¸ªæ”¶è·, é‚£ä¾¿æ˜¯å¯¹Windowsä¸‹å¼€å‘ç¯å¢ƒçš„å°è±¡å¤§ä¸ºæ”¹è§‚. è™½ç„¶WSLè¿˜æœ‰äº›è¿™æ ·é‚£æ ·çš„é—®é¢˜, ä½†åº”ä»˜æ—¥å¸¸å¼€å‘æ˜¾ç„¶å·²ç»é—®é¢˜ä¸å¤§äº†. çœ‹å¾—å‡ºæ¥å¾®è½¯æ˜¯åœ¨æŒç»­ä¸æ–­åœ°ä¼˜åŒ–å¼€å‘ä½“éªŒçš„. ç›¸æ¯”ä¹‹ä¸‹è‹¹æœè¿™å‡ å¹´çš„è¡Œä¸ºå°±åƒåœ¨èµ¶èµ°å¼€å‘è€…ä¸€æ ·, ç¡¬ä»¶ä¸Šè·Ÿx86åˆ†é“æ‰¬é•³ä¸è¯´, è½¯ä»¶ä¸Šä¹Ÿæ—¶ä¸æ—¶ä¼šçœ‹åˆ°æœ‰å¼€å‘è€…å¸¸ç”¨çš„å·¥å…·å‡ºé”™[36]. å¦‚æœMacæ— æ³•ç¡®ä¿ä¸€ä¸ªç¨³å®šçš„å¼€å‘ç¯å¢ƒçš„è¯, è¿˜ä¸å¦‚ç”¨PCå§.

## å‚è€ƒ

* [1] [Tesla engineer testifies that 2016 video promoting self-driving was faked](https://techcrunch.com/2023/01/17/tesla-engineer-testifies-that-2016-video-promoting-self-driving-was-faked/)
* [2] [Zeekr 007](https://www.zeekrlife.com/zeekr007)
* [3] [BEVFormer: a Cutting-edge Baseline for Camera-based Detection](https://github.com/fundamentalvision/BEVFormer)
* [4] [Step-by-step installation instructions](https://github.com/fundamentalvision/BEVFormer/blob/master/docs/install.md)
* [5] [OpenMMLab](https://openmmlab.com/)
* [6] [eGPU.io](https://egpu.io/)
* [7] [USB4](https://en.wikipedia.org/wiki/USB4)
* [8] [Thunderbolt (interface)](https://en.wikipedia.org/wiki/Thunderbolt_(interface))
* [9] [PCI Express](https://en.wikipedia.org/wiki/PCI_Express)
* [10] [Steam Deck LCD](https://www.steamdeck.com/en/tech/deck)
* [11] [USB 3.2](https://en.wikipedia.org/wiki/USB_3.0#USB_3.2)
* [12] [M.2](https://en.wikipedia.org/wiki/M.2)
* [13] [OCuLink: What It Is, Why You Need It, and Where To Get It](https://egpu.io/forums/custom-egpu-chassis/oculink-what-it-is-why-you-need-it-and-where-to-get-it/)
* [14] [Use an external graphics processor with your Mac](https://support.apple.com/en-us/102363)
* [15] [How to install Windows on a Steam Deck](https://www.digitaltrends.com/computing/how-to-install-windows-steam-deck/)
* [16] [We Put A GPU on the Steam Deck](https://www.youtube.com/watch?v=RdgslRR6S2w)
* [17] [CUDA Toolkit](https://developer.nvidia.com/cuda-toolkit)
* [18] [prepare_dataset](https://github.com/fundamentalvision/BEVFormer/blob/master/docs/prepare_dataset.md)
* [19] [nuScenes by Motional](https://www.nuscenes.org/nuscenes)
* [20] [Filesystem in Userspace](https://en.wikipedia.org/wiki/Filesystem_in_Userspace)
* [21] [Random Access Tar Mount (Ratarmount)](https://github.com/mxmlnkn/ratarmount)
* [22] [Advanced settings configuration in WSL](https://learn.microsoft.com/en-us/windows/wsl/wsl-config)
* [23] [Model Zoo](https://github.com/fundamentalvision/BEVFormer?tab=readme-ov-file#model-zoo)
* [24] [getting_started](https://github.com/fundamentalvision/BEVFormer/blob/master/docs/getting_started.md)
* [25] [NCCL](https://github.com/NVIDIA/nccl)
* [26] [Environment Variables](https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-debug)
* [27] [NCCL tests don't work on WSL](https://github.com/NVIDIA/nccl/issues/442)
* [28] [BEVFormer/tools/test.py](https://github.com/fundamentalvision/BEVFormer/blob/2f37d0d4932b064dce49154aef7173688410420f/tools/test.py#L185)
* [29] [BEVFormer/tools/test.py](https://github.com/fundamentalvision/BEVFormer/blob/2f37d0d4932b064dce49154aef7173688410420f/tools/test.py#L228)
* [30] [AVX Instructions](https://docs.oracle.com/cd/E36784_01/html/E36859/gntbd.html)
* [31] [IntelÂ® PentiumÂ® Gold G5420T Processor](https://ark.intel.com/content/www/us/en/ark/products/135455/intel-pentium-gold-g5420t-processor-4m-cache-3-20-ghz.html)
* [32] [CUDA Templates for Linear Algebra Subroutines](https://github.com/NVIDIA/cutlass)
* [33] [Dell OptiPlex 3070 Tower Setup and Specifications](https://www.dell.com/support/manuals/en-us/optiplex-3070-desktop/opti3070_mt_setup_specs/processor?guid=guid-72cc410a-de1d-44be-b12f-78ca48e7182a)
* [34] [BEVFormer/projects/configs/bevformer/bevformer_tiny.py](https://github.com/fundamentalvision/BEVFormer/blob/2f37d0d4932b064dce49154aef7173688410420f/projects/configs/bevformer/bevformer_tiny.py#L173)
* [35] [Introducing Devin](https://www.cognition-labs.com/introducing-devin)
* [36] [Java users on macOS 14 running on Apple silicon systems should consider delaying the macOS 14.4 update](https://blogs.oracle.com/java/post/java-on-macos-14-4)
